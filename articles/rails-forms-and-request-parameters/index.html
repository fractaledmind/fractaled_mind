<!doctype html>
<html lang="en">
  <head>
  <!-- Metadata declarations -->
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Content declarations -->
  <title>Fractaled Mind</title>
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="feed.xml" />

  <!-- External Resources -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js" ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  <!-- Internal Resources -->
  <link href="../../stylesheets/main.css" rel="stylesheet" type="text/css" />
  <link href="../../images/favicon.png" rel="icon" type="image/png" />
  <script src="../../javascripts/bigfoot.js" type="text/javascript"></script>
  <script src="../../javascripts/search.js" type="text/javascript"></script>

  <!-- Bigfoot.js Popover Footnotes -->
  <script type="text/javascript">
    $(document).ready(function(){
      $.bigfoot({
        numberResetSelector: ".card",
        activateCallback: function($popover, $button) {
          if (MathJax && !$button.data('mathjax-processed')) {
            var content_wrapper = $popover.find('.bigfoot-footnote__content')[0];
            MathJax.Hub.Queue(['Typeset', MathJax.Hub, content_wrapper]);
            MathJax.Hub.Queue(function () {
              $button.attr('data-bigfoot-footnote', content_wrapper.innerHTML);
              $button.data('mathjax-processed', true);
            });
          }
        }
      });
    });
  </script>

  <!-- Responsive Tables -->
  <script type="text/javascript">
    $(document).ready(function(){
      $("td").each(function() {
        var $th = $(this).closest('table').find('th').eq($(this).index());
        $(this).attr('data-th', $th.text());
      });
    });
  </script>

  <!-- Scroll-Fix sidebar
  <script type="text/javascript">
    $(window).on("scroll", function(e) {
      var scroll = $(this).scrollTop();
      var logo_height = $('#site-logo').height();
      var nav_height = $('.navigation').height() + 16;

      if (scroll > logo_height) {
        $('.navigation').css({'position': 'fixed'});
         $('#sidebar').css({
           'position': 'fixed',
           'top': nav_height
         });
      } else {
        $('.navigation').css({'position': 'inherit'});
        $('#sidebar').css({'position': 'inherit'});
      }
    });
  </script>
  -->

</head>


  <body>
    <header>
  <div id="site-logo">
    <a href="/" class="no-hvr">
      <img alt="Fractaled Mind" src="../../images/logo-single-line.svg" />
    </a>
  </div>
</header>


    <div class="navigation">
  <ul id="social-networks">
    <li>
      <a href="https://facebook.com/fractaledmind" class="no-hvr">
        <i class="fa fa-facebook fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="https://twitter.com/fractaledmind" class="no-hvr">
        <i class="fa fa-twitter fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="https://github.com/fractaledmind" class="no-hvr">
        <i class="fa fa-github fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="mailto:stephen@fractaledmind.com" class="no-hvr">
        <i class="fa fa-envelope fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="/feed.xml" class="no-hvr">
        <i class="fa fa-rss fa-lg"></i>
      </a>
    </li>
  </ul>

  <nav role="navigation">
    <ul class="navigation-menu">
      <li class="nav-link"><a href="../">articles</a></li>
      <li class="nav-link"><a href="../../projects/">projects</a></li>
      <li class="nav-link"><a href="../../jots/">jots</a></li>
      <li class="nav-link"><a href="../../essays/">essays</a></li>
    </ul>
  </nav>

  <div id="search">
    <div class="searchbar">
      <form role="search" action="/search" method="get">
        <input class="search-term" type="search" placeholder="Search..." name="q" />
        <button class="search-submit" type="submit">
          <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/search-icon-black.png" alt="Search Icon">
        </button>
      </form>
    </div>
  </div>
</div>


    <div id="main" role="main">
      <div class="card" id="project-page">

    <ul class="card-tags">
      <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="ruby-tag" href="/topics/ruby/">ruby</a>
      </li>
      <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="rails-tag" href="/topics/rails/">rails</a>
      </li>
  </ul>


  <!-- if item has tags, add filler element -->
  <div id="tag-filler-space"></div>


  

  <h2 id="title"><p>Rails Forms and Request Parameters</p>
</h2>

  <hr class="fractal">

  <div id="description"><p>Sometimes in our Rails applications we need to build forms that represent state stored in URL query parameters that is independent of any persisted object in our backend datastore, like in the case of a search form. In this post I offer a simple, flexible, generic helper for doing just that.</p>

<span id='readmore'></span>

<blockquote>
  <p><strong>NOTE:</strong> I first detailed this helper in a larger post on <a href="http://fractaledmind.com/articles/basic-restful-filtering-with-rails/">basic RESTful filtering in Rails</a>.</p>
</blockquote>

<hr />

<p>In a stock Rails app, we build forms using the <code>form_for</code> helper. This helper method expects an object, not a hash, so we cannot simply pass some <code>params</code> hash into the helper. Moreover, if you dig into the source code for the <code>form_for</code> method and the <code>FormBuilder</code> object it creates, you will see that it inspects the object it is passed for a <code>#model_name</code> method when constructing input names. It then expects the return value of the <code>#model_name</code> method to respond to the <code>#param_key</code> method (these methods are part of the <a href="http://api.rubyonrails.org/classes/ActiveModel/Naming.html"><code>ActiveModel::Naming</code></a> module). So, in order for our custom built object to work with <code>form_for</code> the way that we desire, we simply need to ensure that <code>object.model_name.param_key</code> returns the parameter namespace we desire.</p>

<p>So, we need a helper that:</p>

<ol>
  <li>takes a param name</li>
  <li>returns an object</li>
  <li>that object returns the param name for the <code>model_name.param_key</code> getter chain</li>
  <li>that object returns any values stored in the params under the appropriate (possibly nested) keys</li>
</ol>

<p>In order to access the appropriate bit of the URL query parameters, our helper first needs to accept the name of the param we are interested in:</p>

<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">FormForHelper</span>
  <span class="k">def</span> <span class="nf">form_for_object_from_param</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>We then need to get the URL query parameters for this param key from the current request parameters (luckily for us, Rails provides the <code>params</code> getter to return an <code>ActionController::Parameters</code> object):</p>

<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">FormForHelper</span>
  <span class="k">def</span> <span class="nf">form_for_object_from_param</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">form_for_params</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="p">{})</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>In order to convert the hash returned from the <code>params.fetch</code> call, we can use the <code>JSON.parse(hash.to_json, object_class: OpenStruct)</code> approach:</p>

<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">FormForHelper</span>
  <span class="k">def</span> <span class="nf">form_for_object_from_param</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">form_for_params</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="p">{})</span>

    <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">form_for_params</span><span class="p">.</span><span class="nf">to_json</span><span class="p">,</span>
               <span class="ss">object_class: </span><span class="no">OpenStruct</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>Finally, in order to ensure that the <code>model_name.param_key</code> getter chain returns the param name, we simply merge the params hash with a hash that <code>OpenStruct</code> will convert into that getter chain:</p>

<div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6
7
8
9</pre></td><td class="code"><pre><span class="k">module</span> <span class="nn">FormForHelper</span>
  <span class="k">def</span> <span class="nf">form_for_object_from_param</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="n">form_for_params</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">form_for_requirements</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">model_name: </span><span class="p">{</span> <span class="ss">param_key: </span><span class="n">param</span> <span class="p">}</span> <span class="p">}</span>

    <span class="no">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">form_for_params</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">form_for_requirements</span><span class="p">).</span><span class="nf">to_json</span><span class="p">,</span>
               <span class="ss">object_class: </span><span class="no">OpenStruct</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table>
</div>

<p>And there it is! This is a simple, flexible, generic helper to create an object that can be passed to <code>form_for</code> which is backed by URL query parameters.</p>
</div>
</div>

    </div>

    <aside id="sidebar">

  <hr class="fractal">

  <div id="recent-articles">
    <h5>Recent Posts</h5>
    <ul class="fa-ul">
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="./">Rails Forms and Request Parameters</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../expecting-exceptions-in-ruby/">Expecting Exceptions in Ruby</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../safely-accessing-values-from-a-nested-hash-again/">Safely Accessing Values from Nested Hashes (again)'</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../basic-restful-filtering-with-rails/">Basic RESTful Filtering with Rails</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../maintaining-binary-state-in-css/">Maintaining Binary State in CSS</a>
        </li>
    </ul>
  </div>

  <hr class="fractal">

  <div id="all-tags">
    <h5><a href="../../topics/">Topics</a></h5>
    <ul class="list-none">
      <!-- Add all Article tags -->
        <li class="breadcrumb">
            <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
            <a class="epistemology-tag" href="/topics/epistemology/">epistemology</a>
            <a class="math-tag" href="/topics/math/">math</a>
        </li>
        <li class="breadcrumb">
            <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
            <a class="epistemology-tag" href="/topics/epistemology/">epistemology</a>
            <a class="logic-tag" href="/topics/logic/">logic</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="pdf-workflow-tag" href="/topics/pdf-workflow/">pdf-workflow</a>
        </li>
        <li class="breadcrumb">
            <a class="prose-tag" href="/topics/prose/">prose</a>
            <a class="self-tag" href="/topics/self/">self</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="ruby-tag" href="/topics/ruby/">ruby</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="rails-tag" href="/topics/rails/">rails</a>
        </li>
        <li class="breadcrumb">
            <a class="poetry-tag" href="/topics/poetry/">poetry</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="algorithms-tag" href="/topics/algorithms/">algorithms</a>
        </li>
        <li class="breadcrumb">
            <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
            <a class="faith-tag" href="/topics/faith/">faith</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="git-tag" href="/topics/git/">git</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="git-tag" href="/topics/git/">git</a>
        </li>
        <li class="breadcrumb">
            <a class="prose-tag" href="/topics/prose/">prose</a>
            <a class="relationships-tag" href="/topics/relationships/">relationships</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="css-tag" href="/topics/css/">css</a>
            <a class="trees-tag" href="/topics/trees/">trees</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="css-tag" href="/topics/css/">css</a>
            <a class="trees-tag" href="/topics/trees/">trees</a>
        </li>
        <li class="breadcrumb">
            <a class="poetry-tag" href="/topics/poetry/">poetry</a>
            <a class="relationships-tag" href="/topics/relationships/">relationships</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="css-tag" href="/topics/css/">css</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="http-tag" href="/topics/http/">http</a>
        </li>
        <li class="breadcrumb">
            <a class="prose-tag" href="/topics/prose/">prose</a>
            <a class="life-tag" href="/topics/life/">life</a>
        </li>
        <li class="breadcrumb">
            <a class="prose-tag" href="/topics/prose/">prose</a>
            <a class="faith-tag" href="/topics/faith/">faith</a>
        </li>
        <li class="breadcrumb">
            <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
            <a class="ethics-tag" href="/topics/ethics/">ethics</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="ruby-tag" href="/topics/ruby/">ruby</a>
            <a class="interpreter-tag" href="/topics/interpreter/">interpreter</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="interpreter-tag" href="/topics/interpreter/">interpreter</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="mvc-tag" href="/topics/mvc/">mvc</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="latin-tag" href="/topics/latin/">latin</a>
            <a class="vergil-tag" href="/topics/vergil/">vergil</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="epicurus-tag" href="/topics/epicurus/">epicurus</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="aristotle-tag" href="/topics/aristotle/">aristotle</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="latin-tag" href="/topics/latin/">latin</a>
            <a class="horace-tag" href="/topics/horace/">horace</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="modern-tag" href="/topics/modern/">modern</a>
            <a class="lewis-tag" href="/topics/lewis/">lewis</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="modern-tag" href="/topics/modern/">modern</a>
            <a class="barfield-tag" href="/topics/barfield/">barfield</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="herodotus-tag" href="/topics/herodotus/">herodotus</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="hippocrates-tag" href="/topics/hippocrates/">hippocrates</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="plato-tag" href="/topics/plato/">plato</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="modern-tag" href="/topics/modern/">modern</a>
            <a class="saussure-tag" href="/topics/saussure/">saussure</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="alfred-tag" href="/topics/alfred/">alfred</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="bash-tag" href="/topics/bash/">bash</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="python-tag" href="/topics/python/">python</a>
        </li>
    </ul>
  </div>
</aside>


    <footer role="contentinfo">
  <div class="footer-info">
    <p>&copy; Copyright 2015 by Stephen Margheim</p>
    <p>Powered by <a href="https://middlemanapp.com">Middleman</a>.</p>
  </div>
</footer>


  </body>
</html>
