<!doctype html>
<html lang="en">

<head>
  <!-- Metadata declarations -->
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Content declarations -->
  <title>Fractaled Mind</title>
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="feed.xml" />

  <!-- External Resources -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  <!-- Internal Resources -->
  <link href="../../stylesheets/main.css" rel="stylesheet" type="text/css" />
  <link href="../../images/favicon.png" rel="icon" type="image/png" />
  <script src="../../javascripts/bigfoot.js" type="text/javascript"></script>
  <script src="../../javascripts/search.js" type="text/javascript"></script>

  <!-- Bigfoot.js Popover Footnotes -->
  <script type="text/javascript">
    $(document).ready(function() {
      $.bigfoot({
        numberResetSelector: ".card",
        activateCallback: function($popover, $button) {
          if (MathJax && !$button.data('mathjax-processed')) {
            var content_wrapper = $popover.find('.bigfoot-footnote__content')[0];
            MathJax.Hub.Queue(['Typeset', MathJax.Hub, content_wrapper]);
            MathJax.Hub.Queue(function() {
              $button.attr('data-bigfoot-footnote', content_wrapper.innerHTML);
              $button.data('mathjax-processed', true);
            });
          }
        }
      });
    });
  </script>

  <!-- Responsive Tables -->
  <script type="text/javascript">
    $(document).ready(function() {
      $("td").each(function() {
        var $th = $(this).closest('table').find('th').eq($(this).index());
        $(this).attr('data-th', $th.text());
      });
    });
  </script>

  <!-- Scroll-Fix sidebar
  <script type="text/javascript">
    $(window).on("scroll", function(e) {
      var scroll = $(this).scrollTop();
      var logo_height = $('#site-logo').height();
      var nav_height = $('.navigation').height() + 16;

      if (scroll > logo_height) {
        $('.navigation').css({'position': 'fixed'});
         $('#sidebar').css({
           'position': 'fixed',
           'top': nav_height
         });
      } else {
        $('.navigation').css({'position': 'inherit'});
        $('#sidebar').css({'position': 'inherit'});
      }
    });
  </script>
  -->

</head>

<body>
  <header>
    <div id="site-logo">
      <a href="/" class="no-hvr">
        <img alt="Fractaled Mind" src="../../images/logo-single-line.svg" />
      </a>
    </div>
  </header>

  <div class="navigation">
    <ul id="social-networks">
      <li>
        <a href="https://facebook.com/fractaledmind" class="no-hvr">
          <i class="fa fa-facebook fa-lg"></i>
        </a>
      </li>
      <li>
        <a href="https://twitter.com/fractaledmind" class="no-hvr">
          <i class="fa fa-twitter fa-lg"></i>
        </a>
      </li>
      <li>
        <a href="https://github.com/fractaledmind" class="no-hvr">
          <i class="fa fa-github fa-lg"></i>
        </a>
      </li>
      <li>
        <a href="mailto:stephen@fractaledmind.com" class="no-hvr">
          <i class="fa fa-envelope fa-lg"></i>
        </a>
      </li>
      <li>
        <a href="/feed.xml" class="no-hvr">
          <i class="fa fa-rss fa-lg"></i>
        </a>
      </li>
    </ul>

    <nav role="navigation">
      <ul class="navigation-menu">
        <li class="nav-link"><a href="../">articles</a></li>
        <li class="nav-link"><a href="../../projects/">projects</a></li>
        <li class="nav-link"><a href="../../jots/">jots</a></li>
        <li class="nav-link"><a href="../../essays/">essays</a></li>
      </ul>
    </nav>

    <div id="search">
      <div class="searchbar">
        <form role="search" action="/search" method="get">
          <input class="search-term" type="search" placeholder="Search..." name="q" />
          <button class="search-submit" type="submit">
            <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/search-icon-black.png" alt="Search Icon">
          </button>
        </form>
      </div>
    </div>
  </div>

  <div id="main" role="main">
    <div class="card" id="project-page">

      <ul class="card-tags">
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="ruby-tag" href="/topics/ruby/">ruby</a>
        </li>
      </ul>

      <!-- if item has tags, add filler element -->
      <div id="tag-filler-space"></div>

      <h2 id="title">
        <p>Generating Hex-ULIDs in Ruby</p>
      </h2>

      <hr class="fractal">

      <div id="description">
        <p>In <a href="sqlite-quasi-ulids/">the previous post</a>, we explored how to generate a base16-encoded <a href="https://github.com/ulid/spec"><abbr title="Universally Unique Lexicographically Sortable Identifier">ULID</abbr></a> with only native SQLite functions. In the end, we built an expression that will generate hex-ULIDs for us:</p>
        <div class="highlight sql"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre><span class="k">SELECT</span> <span class="n">PRINTF</span><span class="p">(</span><span class="s1">'%012X'</span><span class="p">,</span> <span class="k">CAST</span><span class="p">(</span><span class="n">ROUND</span><span class="p">((</span><span class="n">JULIANDAY</span><span class="p">(</span><span class="s1">'now'</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2440587</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mi">86400000</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">INTEGER</span><span class="p">))</span> <span class="o">||</span> <span class="n">HEX</span><span class="p">(</span><span class="n">RANDOMBLOB</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="k">AS</span> <span class="n">qulid</span><span class="p">;</span></pre></td></tr></tbody></table></div>
        <p>This expression will return a 32 character string like <code>0184E14B9D33DF0EA40E00D20FC31406</code>, which encodes a 48 bit timestamp and an 80 bit random portion, producing a 128 bit blob just like ULIDs and UUIDs. The string is composed of an 12 character base16-encoded timestamp and a 20 character random portion.</p>
        <p>But what if we need to generate a hex-ULID in Ruby?</p>
        <h3 id="ruby-hex-ulids">Ruby Hex-ULIDs</h3>
        <p>Let's convert our SQLite expression into a Ruby function.</p>
        <div class="highlight ruby"><table class="line-table"><tbody><tr id="line-1" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>1</pre></td><td class="code"><pre><span class="k">class</span> <span class="nc">HexULID</span></pre></td></tr><tr id="line-2" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>2</pre></td><td class="code"><pre>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">generate</span><span class="p">(</span><span class="ss">moment: </span><span class="kp">nil</span><span class="p">,</span> <span class="ss">entropy: </span><span class="kp">nil</span><span class="p">)</span></pre></td></tr><tr id="line-3" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>3</pre></td><td class="code"><pre>    <span class="n">moment</span> <span class="o">||=</span> <span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_r</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">to_i</span></pre></td></tr><tr id="line-4" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>4</pre></td><td class="code"><pre>    <span class="n">entropy</span> <span class="o">||=</span> <span class="no">SecureRandom</span><span class="p">.</span><span class="nf">random_bytes</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span></pre></td></tr><tr id="line-5" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>5</pre></td><td class="code"><pre>    </pre></td></tr><tr id="line-6" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>6</pre></td><td class="code"><pre>    <span class="n">hex_timestamp</span> <span class="o">=</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'%012X'</span><span class="p">,</span> <span class="n">moment</span><span class="p">)</span></pre></td></tr><tr id="line-7" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>7</pre></td><td class="code"><pre>    <span class="n">hex_randomness</span> <span class="o">=</span> <span class="n">entropy</span><span class="p">.</span><span class="nf">bytes</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">byte</span><span class="o">|</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">'%02X'</span><span class="p">,</span> <span class="n">byte</span><span class="p">)</span> <span class="p">}.</span><span class="nf">join</span></pre></td></tr><tr id="line-8" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>8</pre></td><td class="code"><pre>    <span class="n">hex_timestamp</span> <span class="o">&lt;&lt;</span> <span class="n">hex_randomness</span></pre></td></tr><tr id="line-9" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>9</pre></td><td class="code"><pre>  <span class="k">end</span></pre></td></tr><tr id="line-10" class="lineno"><td class="gutter gl" style="-moz-user-select: none;-ms-user-select: none;-webkit-user-select: none;user-select: none;"><pre>10</pre></td><td class="code"><pre><span class="k">end</span></pre></td></tr></tbody></table></div>
        <p>This <code>HexULID</code> class will generate strings <em>in exactly the same format</em> as our SQLite expression. This will allow us to generate our hex-ULIDs in either Ruby or SQLite, which will make schema migrations and various code patterns easier.</p>
        <p>In the future, we will explore how to make a schema migration to make use of such hex-ULIDs in a new or existing Rails project.</p>
      </div>
    </div>

  </div>

  <aside id="sidebar">

    <hr class="fractal">

    <div id="recent-articles">
      <h5>Recent Posts</h5>
      <ul class="fa-ul">
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../slideover-bootstrap-modals/">Slideover Bootstrap Modals</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../rails-forms-and-request-parameters/">Rails Forms and Request Parameters</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../expecting-exceptions-in-ruby/">Expecting Exceptions in Ruby</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../safely-accessing-values-from-a-nested-hash-again/">Safely Accessing Values from Nested Hashes (again)'</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../basic-restful-filtering-with-rails/">Basic RESTful Filtering with Rails</a>
        </li>
      </ul>
    </div>

    <hr class="fractal">

    <div id="all-tags">
      <h5><a href="../../topics/">Topics</a></h5>
      <ul class="list-none">
        <!-- Add all Article tags -->
        <li class="breadcrumb">
          <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
          <a class="epistemology-tag" href="/topics/epistemology/">epistemology</a>
          <a class="math-tag" href="/topics/math/">math</a>
        </li>
        <li class="breadcrumb">
          <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
          <a class="epistemology-tag" href="/topics/epistemology/">epistemology</a>
          <a class="logic-tag" href="/topics/logic/">logic</a>
        </li>
        <li class="breadcrumb">
          <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
          <a class="pdf-workflow-tag" href="/topics/pdf-workflow/">pdf-workflow</a>
        </li>
        <li class="breadcrumb">
          <a class="prose-tag" href="/topics/prose/">prose</a>
          <a class="self-tag" href="/topics/self/">self</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="ruby-tag" href="/topics/ruby/">ruby</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="rails-tag" href="/topics/rails/">rails</a>
        </li>
        <li class="breadcrumb">
          <a class="poetry-tag" href="/topics/poetry/">poetry</a>
        </li>
        <li class="breadcrumb">
          <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
          <a class="algorithms-tag" href="/topics/algorithms/">algorithms</a>
        </li>
        <li class="breadcrumb">
          <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
          <a class="faith-tag" href="/topics/faith/">faith</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="git-tag" href="/topics/git/">git</a>
        </li>
        <li class="breadcrumb">
          <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
          <a class="git-tag" href="/topics/git/">git</a>
        </li>
        <li class="breadcrumb">
          <a class="prose-tag" href="/topics/prose/">prose</a>
          <a class="relationships-tag" href="/topics/relationships/">relationships</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="css-tag" href="/topics/css/">css</a>
          <a class="trees-tag" href="/topics/trees/">trees</a>
        </li>
        <li class="breadcrumb">
          <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
          <a class="css-tag" href="/topics/css/">css</a>
          <a class="trees-tag" href="/topics/trees/">trees</a>
        </li>
        <li class="breadcrumb">
          <a class="poetry-tag" href="/topics/poetry/">poetry</a>
          <a class="relationships-tag" href="/topics/relationships/">relationships</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="css-tag" href="/topics/css/">css</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="http-tag" href="/topics/http/">http</a>
        </li>
        <li class="breadcrumb">
          <a class="prose-tag" href="/topics/prose/">prose</a>
          <a class="life-tag" href="/topics/life/">life</a>
        </li>
        <li class="breadcrumb">
          <a class="prose-tag" href="/topics/prose/">prose</a>
          <a class="faith-tag" href="/topics/faith/">faith</a>
        </li>
        <li class="breadcrumb">
          <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
          <a class="ethics-tag" href="/topics/ethics/">ethics</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="ruby-tag" href="/topics/ruby/">ruby</a>
          <a class="interpreter-tag" href="/topics/interpreter/">interpreter</a>
        </li>
        <li class="breadcrumb">
          <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
          <a class="interpreter-tag" href="/topics/interpreter/">interpreter</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="css-tag" href="/topics/css/">css</a>
          <a class="bootstrap-tag" href="/topics/bootstrap/">bootstrap</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="mvc-tag" href="/topics/mvc/">mvc</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="latin-tag" href="/topics/latin/">latin</a>
          <a class="vergil-tag" href="/topics/vergil/">vergil</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="greek-tag" href="/topics/greek/">greek</a>
          <a class="epicurus-tag" href="/topics/epicurus/">epicurus</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="greek-tag" href="/topics/greek/">greek</a>
          <a class="aristotle-tag" href="/topics/aristotle/">aristotle</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="latin-tag" href="/topics/latin/">latin</a>
          <a class="horace-tag" href="/topics/horace/">horace</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="modern-tag" href="/topics/modern/">modern</a>
          <a class="lewis-tag" href="/topics/lewis/">lewis</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="modern-tag" href="/topics/modern/">modern</a>
          <a class="barfield-tag" href="/topics/barfield/">barfield</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="greek-tag" href="/topics/greek/">greek</a>
          <a class="herodotus-tag" href="/topics/herodotus/">herodotus</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="greek-tag" href="/topics/greek/">greek</a>
          <a class="hippocrates-tag" href="/topics/hippocrates/">hippocrates</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="greek-tag" href="/topics/greek/">greek</a>
          <a class="plato-tag" href="/topics/plato/">plato</a>
        </li>
        <li class="breadcrumb">
          <a class="academia-tag" href="/topics/academia/">academia</a>
          <a class="modern-tag" href="/topics/modern/">modern</a>
          <a class="saussure-tag" href="/topics/saussure/">saussure</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="alfred-tag" href="/topics/alfred/">alfred</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="bash-tag" href="/topics/bash/">bash</a>
        </li>
        <li class="breadcrumb">
          <a class="code-tag" href="/topics/code/">code</a>
          <a class="python-tag" href="/topics/python/">python</a>
        </li>
      </ul>
    </div>
  </aside>

  <footer role="contentinfo">
    <div class="footer-info">
      <p>&copy; Copyright 2022 by Stephen Margheim</p>
      <p>Powered by <a href="https://middlemanapp.com">Middleman</a>.</p>
    </div>
  </footer>

</body>

</html>
