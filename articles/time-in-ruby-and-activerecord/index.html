<!doctype html>
<html lang="en">
  <head>
  <!-- Metadata declarations -->
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Content declarations -->
  <title>Fractaled Mind</title>
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="feed.xml" />

  <!-- External Resources -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js" ></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>

  <!-- Internal Resources -->
  <link href="../../stylesheets/main.css" rel="stylesheet" type="text/css" />
  <link href="../../images/favicon.png" rel="icon" type="image/png" />
  <script src="../../javascripts/bigfoot.js" type="text/javascript"></script>
  <script src="../../javascripts/search.js" type="text/javascript"></script>

  <!-- Bigfoot.js Popover Footnotes -->
  <script type="text/javascript">
    $(document).ready(function(){
      $.bigfoot({
        numberResetSelector: ".card",
        activateCallback: function($popover, $button) {
          if (MathJax && !$button.data('mathjax-processed')) {
            var content_wrapper = $popover.find('.bigfoot-footnote__content')[0];
            MathJax.Hub.Queue(['Typeset', MathJax.Hub, content_wrapper]);
            MathJax.Hub.Queue(function () {
              $button.attr('data-bigfoot-footnote', content_wrapper.innerHTML);
              $button.data('mathjax-processed', true);
            });
          }
        }
      });
    });
  </script>

  <!-- Responsive Tables -->
  <script type="text/javascript">
    $(document).ready(function(){
      $("td").each(function() {
        var $th = $(this).closest('table').find('th').eq($(this).index());
        $(this).attr('data-th', $th.text());
      });
    });
  </script>

  <!-- Scroll-Fix sidebar
  <script type="text/javascript">
    $(window).on("scroll", function(e) {
      var scroll = $(this).scrollTop();
      var logo_height = $('#site-logo').height();
      var nav_height = $('.navigation').height() + 16;

      if (scroll > logo_height) {
        $('.navigation').css({'position': 'fixed'});
         $('#sidebar').css({
           'position': 'fixed',
           'top': nav_height
         });
      } else {
        $('.navigation').css({'position': 'inherit'});
        $('#sidebar').css({'position': 'inherit'});
      }
    });
  </script>
  -->

</head>


  <body>
    <header>
  <div id="site-logo">
    <a href="/" class="no-hvr">
      <img alt="Fractaled Mind" src="../../images/logo-single-line.svg" />
    </a>
  </div>
</header>


    <div class="navigation">
  <ul id="social-networks">
    <li>
      <a href="https://facebook.com/fractaledmind" class="no-hvr">
        <i class="fa fa-facebook fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="https://twitter.com/fractaledmind" class="no-hvr">
        <i class="fa fa-twitter fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="https://github.com/fractaledmind" class="no-hvr">
        <i class="fa fa-github fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="mailto:stephen@fractaledmind.com" class="no-hvr">
        <i class="fa fa-envelope fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="/feed.xml" class="no-hvr">
        <i class="fa fa-rss fa-lg"></i>
      </a>
    </li>
  </ul>

  <nav role="navigation">
    <ul class="navigation-menu">
      <li class="nav-link"><a href="../">articles</a></li>
      <li class="nav-link"><a href="../../projects/">projects</a></li>
      <li class="nav-link"><a href="../../jots/">jots</a></li>
      <li class="nav-link"><a href="../../essays/">essays</a></li>
    </ul>
  </nav>

  <div id="search">
    <div class="searchbar">
      <form role="search" action="/search" method="get">
        <input class="search-term" type="search" placeholder="Search..." name="q" />
        <button class="search-submit" type="submit">
          <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/search-icon-black.png" alt="Search Icon">
        </button>
      </form>
    </div>
  </div>
</div>


    <div id="main" role="main">
      <div class="card" id="project-page">

    <ul class="card-tags">
      <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="ruby-tag" href="/topics/ruby/">ruby</a>
      </li>
      <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="rails-tag" href="/topics/rails/">rails</a>
      </li>
  </ul>


  <!-- if item has tags, add filler element -->
  <div id="tag-filler-space"></div>


  

  <h2 id="title"><p>Time in Ruby and ActiveRecord</p>
</h2>

  <hr class="fractal">

  <div id="description"><p>I recently lost about a day of work trying to figure what the hell was going on when I was working with an ActiveRecord model that had a <code>time</code> type column. In the hopes that I will not loose such time again and that this post can help others avoid such lost time, I want to lay out my investigation into time in Ruby and ActiveRecord.</p>

<p>Let’s start with Ruby. The <a href="https://ruby-doc.org/core-2.4.1/Time.html">documentation for Ruby 2.4.1</a> describes the <code>Time</code> class like so:</p>

<blockquote>
  <p>Time is an abstraction of dates and times. Time is stored internally as the number of seconds with fraction since the Epoch, January 1, 1970 00:00 UTC.</p>
</blockquote>

<p>In short, an instance of the <code>Time</code> class represents an <em>exact</em> moment in the history of our world (down to the nanosecond), a moment that happened on a particular date and at a particular time. The Ruby documentation offers the following example for creating a new instance of <code>Time</code> where we set the year, month, day, hour, minute, and second: <code>Time.new(2002, 10, 31, 2, 2, 2)</code>. Those are the elements (plus the timezone) that compose an instance of <code>Time</code>.</p>

<p>Alright, now what about time in ActiveRecord? In ActiveRecord you can specify that a database column is of type <code>time</code> (e.g. <code>create_table :foos { |t| t.time :column }</code>). Now, if you are anything like me, you don’t have the column type in your application, so you probably don’t know much about what it is or how it works. So, what’s the first thing I do when I’m dealing with a new concept or problem? I start poking at it.</p>

<p>I had a Rails application with a test database, so I opened a console in the test environment and starting poking. I’m working with an instance of the <code>Foo</code> class (defined in this context as <code>foo</code>) that has a column called <code>time</code> that is, you guessed it, of type <code>time</code>:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>&gt; foo.time
=&gt; Sat, 01 Jan 2000 01:00:00 UTC +00:00
&gt; foo.time.class
=&gt; ActiveSupport::TimeWithZone
</pre></td></tr></tbody></table>
</div>

<p>The first thing I want to do is look at a value from the <code>time</code> column. I find that ActiveRecord returns an instance of the <code>ActiveSupport::TimeWithZone</code> class, which is a wrapper around Ruby’s <code>Time</code> class.<sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup> This makes sense; a column of database type <code>time</code> stores an instance of the Ruby <code>Time</code> class, or so I think. The next thing I do is start playing with this <code>time</code> column:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>&gt; foo.time = 1.day.from_now.to_time
=&gt; 2017-11-17 15:08:54 -0500
&gt; foo.time
=&gt; Sat, 01 Jan 2000 20:08:54 UTC +00:00
</pre></td></tr></tbody></table>
</div>

<p>Hrm. All of the date bits about our time disappeared… What in the hell is going on? As any sane developer would when faced with a situation that doesn’t make sense, I start Googling: “activerecord time column”, “active record column types”, etc. I can’t find official documentation anywhere for what the hell a <code>time</code> database column is. Luckily, there are other other sources of unofficial documentation (i.e. StackOverflow). In <a href="https://stackoverflow.com/a/11894584/2884386">one</a> I find this:</p>

<blockquote>
  <ul>
    <li>Time:
      <ul>
        <li>Stores only a time (hours, minutes, seconds)</li>
      </ul>
    </li>
  </ul>
</blockquote>

<p>In <a href="https://stackoverflow.com/a/25702629/2884386">another</a> I found these images:</p>

<p>&lt;%= image_tag ‘activerecord-column-types-1.png’ %&gt;
&lt;%= image_tag ‘activerecord-column-types-2.png’ %&gt;</p>

<p>In my test database, I’m using SQlite, so this column is being stored in the actual database as a SQLite <code>datetime</code> object. However, the first answer says that a column of this type represents <em>only</em> the combination of hour, minute, and second. Ok. Well, still, what’s going on here?</p>

<p>The short answer is that Ruby has no class to represent <em>only</em> the combinarion of hour, minute, and second. While <code>Date</code> represents year, month, and day, and <code>Time</code> represents year, month, day, hour, minute, and second (I will write more about <code>Time</code> and <code>DateTime</code> at a later date), there is no class for simply hour, minute, and second. So, what does ActiveRecord do? The only thing it really can do, use the <code>Time</code> class. But, in order to ensure that the year, month, and day are meaningless, ActiveRecord <strong>always</strong> forces the year, month, and day of any value set for a <code>time</code> type column to be <code>2000-01-01</code>.</p>

<p>This is why our date information disappeared in the above example. When ActiveRecord casts the value passed in (<code>1.day.from_now.to_time</code>), it resets the date portion. This can be seen by inspecting the <code>time_before_type_cast</code> value:</p>

<div class="highlight plaintext"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5
6</pre></td><td class="code"><pre>&gt; foo.time = 1.day.from_now.to_time
=&gt; 2017-11-17 15:08:54 -0500
&gt; foo.time
=&gt; Sat, 01 Jan 2000 20:08:54 UTC +00:00
&gt; foo.time_before_type_cast
=&gt; 2017-11-17 15:08:54 -0500
</pre></td></tr></tbody></table>
</div>

<p>So, in short, the ActiveRecord <code>time</code> column type, while it does return an instance of the Ruby <code>Time</code> class, <strong>does not</strong> represent the same kind of object. Ruby <code>Time</code> represents year, month, day, hour, minute, and second. ActiveRecord <code>time</code> represents hour, minute, and second.</p>

<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>You can read more about this class <a href="http://api.rubyonrails.org/v5.1/classes/ActiveSupport/TimeWithZone.html">here</a>. <a href="#fnref:1" class="reversefootnote">&#8617;</a></p>
    </li>
  </ol>
</div>
</div>
</div>

    </div>

    <aside id="sidebar">

  <hr class="fractal">

  <div id="recent-articles">
    <h5>Recent Posts</h5>
    <ul class="fa-ul">
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../css-tree-vertical/">Building Pure CSS Trees (part 2)</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../css-tree/">Building Pure CSS Trees (part 1)</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../on-white-lies-and-gas-lights/">On White Lies and Gas Lights</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../ruby-logic-interpreter-2/">Building an Interpreter for Propositional Logic</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../ruby-logic-interpreter-1/">Building an Interpreter for Propositional Logic</a>
        </li>
    </ul>
  </div>

  <hr class="fractal">

  <div id="all-tags">
    <h5><a href="../../topics/">Topics</a></h5>
    <ul class="list-none">
      <!-- Add all Article tags -->
        <li class="breadcrumb">
            <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
            <a class="epistemology-tag" href="/topics/epistemology/">epistemology</a>
            <a class="math-tag" href="/topics/math/">math</a>
        </li>
        <li class="breadcrumb">
            <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
            <a class="epistemology-tag" href="/topics/epistemology/">epistemology</a>
            <a class="logic-tag" href="/topics/logic/">logic</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="pdf-workflow-tag" href="/topics/pdf-workflow/">pdf-workflow</a>
        </li>
        <li class="breadcrumb">
            <a class="prose-tag" href="/topics/prose/">prose</a>
            <a class="self-tag" href="/topics/self/">self</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="ruby-tag" href="/topics/ruby/">ruby</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="rails-tag" href="/topics/rails/">rails</a>
        </li>
        <li class="breadcrumb">
            <a class="poetry-tag" href="/topics/poetry/">poetry</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="algorithms-tag" href="/topics/algorithms/">algorithms</a>
        </li>
        <li class="breadcrumb">
            <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
            <a class="faith-tag" href="/topics/faith/">faith</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="git-tag" href="/topics/git/">git</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="git-tag" href="/topics/git/">git</a>
        </li>
        <li class="breadcrumb">
            <a class="prose-tag" href="/topics/prose/">prose</a>
            <a class="relationships-tag" href="/topics/relationships/">relationships</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="css-tag" href="/topics/css/">css</a>
            <a class="trees-tag" href="/topics/trees/">trees</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="css-tag" href="/topics/css/">css</a>
            <a class="trees-tag" href="/topics/trees/">trees</a>
        </li>
        <li class="breadcrumb">
            <a class="poetry-tag" href="/topics/poetry/">poetry</a>
            <a class="relationships-tag" href="/topics/relationships/">relationships</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="css-tag" href="/topics/css/">css</a>
        </li>
        <li class="breadcrumb">
            <a class="prose-tag" href="/topics/prose/">prose</a>
            <a class="life-tag" href="/topics/life/">life</a>
        </li>
        <li class="breadcrumb">
            <a class="prose-tag" href="/topics/prose/">prose</a>
            <a class="faith-tag" href="/topics/faith/">faith</a>
        </li>
        <li class="breadcrumb">
            <a class="philosophy-tag" href="/topics/philosophy/">philosophy</a>
            <a class="ethics-tag" href="/topics/ethics/">ethics</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="ruby-tag" href="/topics/ruby/">ruby</a>
            <a class="interpreter-tag" href="/topics/interpreter/">interpreter</a>
        </li>
        <li class="breadcrumb">
            <a class="tutorial-tag" href="/topics/tutorial/">tutorial</a>
            <a class="interpreter-tag" href="/topics/interpreter/">interpreter</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="latin-tag" href="/topics/latin/">latin</a>
            <a class="vergil-tag" href="/topics/vergil/">vergil</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="epicurus-tag" href="/topics/epicurus/">epicurus</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="aristotle-tag" href="/topics/aristotle/">aristotle</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="latin-tag" href="/topics/latin/">latin</a>
            <a class="horace-tag" href="/topics/horace/">horace</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="modern-tag" href="/topics/modern/">modern</a>
            <a class="lewis-tag" href="/topics/lewis/">lewis</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="modern-tag" href="/topics/modern/">modern</a>
            <a class="barfield-tag" href="/topics/barfield/">barfield</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="herodotus-tag" href="/topics/herodotus/">herodotus</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="hippocrates-tag" href="/topics/hippocrates/">hippocrates</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="greek-tag" href="/topics/greek/">greek</a>
            <a class="plato-tag" href="/topics/plato/">plato</a>
        </li>
        <li class="breadcrumb">
            <a class="academia-tag" href="/topics/academia/">academia</a>
            <a class="modern-tag" href="/topics/modern/">modern</a>
            <a class="saussure-tag" href="/topics/saussure/">saussure</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="alfred-tag" href="/topics/alfred/">alfred</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="bash-tag" href="/topics/bash/">bash</a>
        </li>
        <li class="breadcrumb">
            <a class="code-tag" href="/topics/code/">code</a>
            <a class="python-tag" href="/topics/python/">python</a>
        </li>
    </ul>
  </div>
</aside>


    <footer role="contentinfo">
  <div class="footer-info">
    <p>&copy; Copyright 2015 by Stephen Margheim</p>
    <p>Powered by <a href="https://middlemanapp.com">Middleman</a>.</p>
  </div>
</footer>


  </body>
</html>
