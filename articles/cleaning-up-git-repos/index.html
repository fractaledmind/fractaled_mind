<!doctype html>
<html lang="en">
  <head>
  <!-- Metadata declarations -->
  <meta charset="utf-8" />
  <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Content declarations -->
  <title>Fractaled Mind - Cleaning up Git repos</title>
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="feed.xml" />

  <!-- External Resources -->
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js" ></script>
  <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  <!-- Internal Resources -->
  <link href="../../stylesheets/main.css" rel="stylesheet" type="text/css" />
  <link href="../../images/favicon.png" rel="icon" type="image/png" />
  <script src="../../javascripts/bigfoot.min.js" type="text/javascript"></script>
  <script src="../../javascripts/search.js" type="text/javascript"></script>

  <!-- Bigfoot.js Popover Footnotes -->
  <script type="text/javascript">
    $(document).ready(function(){
      $.bigfoot(
        { numberResetSelector: ".card" }
      );
    });
  </script>

  <!-- Responsive Tables -->
  <script type="text/javascript">
    $(document).ready(function(){
      $("td").each(function() {
        var $th = $(this).closest('table').find('th').eq($(this).index());
        $(this).attr('data-th', $th.text());
      });
    });
  </script>

  <!-- Scroll-Fix sidebar
  <script type="text/javascript">
    $(window).on("scroll", function(e) {
      var scroll = $(this).scrollTop();
      var logo_height = $('#site-logo').height();
      var nav_height = $('.navigation').height() + 16;

      if (scroll > logo_height) {
        $('.navigation').css({'position': 'fixed'});
         $('#sidebar').css({
           'position': 'fixed',
           'top': nav_height
         });
      } else {
        $('.navigation').css({'position': 'inherit'});
        $('#sidebar').css({'position': 'inherit'});
      }
    });
  </script>
  -->

</head>


  <body>
    <header>
  <div id="site-logo">
    <img alt="Fractaled Mind" src="../../images/logo.svg" />
  </div>

  <ul id="social-networks">
    <li>
      <a href="https://facebook.com/fractaledmind" class="no-hvr">
        <i class="fa fa-facebook fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="https://twitter.com/fractaledmind" class="no-hvr">
        <i class="fa fa-twitter fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="https://github.com/smargh" class="no-hvr">
        <i class="fa fa-github fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="mailto:stephen@fractaledmind.com" class="no-hvr">
        <i class="fa fa-envelope fa-lg"></i>
      </a>
    </li>
    <li>
      <a href="/feed.xml" class="no-hvr">
        <i class="fa fa-rss fa-lg"></i>
      </a>
    </li>
  </ul>
</header>

    <div class="navigation">
  <nav role="navigation">
    <ul class="navigation-menu">
      <li class="nav-link"><a href="/">home</a></li>
      <li class="nav-link"><a href="/jots">jots</a></li>
      <li class="nav-link"><a href="/projects">projects</a></li>
    </ul>
  </nav>

  <div id="search">
    <div class="searchbar">
      <form role="search" action="/search" method="get">
        <input class="search-term" type="search" placeholder="Search..." name="q" />
        <button class="search-submit" type="submit">
          <img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/search-icon-black.png" alt="Search Icon">
        </button>
      </form>
    </div>
  </div>
</div>


    <div id="main" role="main">
        <article class="card">
    <!-- Article shows tags in top right -->
    <ul class="card-tags">
          <li>
            <a class="badge no-hvr" id="til" href="/topics/til/">til</a>
          </li>
    </ul>

    <h2 id="title">Cleaning up Git repos</h2>

    <h3 id="deleting-old-remote-branches">Deleting old remote branches</h3>

<p>If you have a repository that’s been around for long enough, you probably have a fair number of “stray branches”: deadends, false starts, orphans, etc. Let’s clean up all of the remote branches that haven’t been touched in the last 6 months:</p>

<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4
5</pre></td><td class="code"><pre><span class="k">for </span>k <span class="k">in</span> <span class="k">$(</span>git branch -r | grep -E -v <span class="s1">'&gt;|master|prod'</span><span class="k">)</span>; <span class="k">do
  if</span> <span class="o">[</span> -z <span class="s2">"</span><span class="k">$(</span>git log -1 --since<span class="o">=</span><span class="s1">'6 months ago'</span> -s <span class="nv">$k</span><span class="k">)</span><span class="s2">"</span> <span class="o">]</span>; <span class="k">then
    </span>git push origin --delete <span class="k">$(</span>cut -d<span class="s2">"/"</span> -f2- <span class="o">&lt;&lt;&lt;</span> <span class="s2">"</span><span class="nv">$k</span><span class="s2">"</span><span class="k">)</span>;
  <span class="k">fi
done</span>
</pre></td></tr></tbody></table>
</div>

<p>Walking through the various steps:</p>

<ol>
  <li><code>git branch -r</code> lists all remote branches</li>
  <li><code>grep -E -v '&gt;|master|prod'</code> filters that list of branches, removing any that have <code>&gt;</code> (e.g. <code>origin/HEAD -&gt; origin/master</code>), <code>master</code> (e.g. <code>origin/master</code>), or <code>prod</code> (e.g. <code>origin/prod</code>) in their names.</li>
  <li>Iterating over each of these branches (as <code>$k</code>), <code>git log -1 --since='6 months ago' -s $k</code> checks if the branch has been commited to in the last 6 months (you could obviously set the timeframe to whatever suited your needs).</li>
  <li><code>cut -d"/" -f2- &lt;&lt;&lt; "$k")</code> trims a branch string like <code>origin/feature/some_branch</code> to a string like <code>feature/some_branch</code>.</li>
  <li>Finally <code>git push origin --delete $(...)</code> removes that branch from the remote repository.</li>
</ol>

<h3 id="deleting-already-merged-remote-branches">Deleting already-merged remote branches</h3>

<p>You may also find yourself needing to remove remote branches that have also already been merged to <code>master</code>.</p>

<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1
2
3
4</pre></td><td class="code"><pre>git branch -r --merged origin/master
| grep -E -v <span class="s1">'&gt;|master|prod'</span>
| cut -d<span class="s2">"/"</span> -f2-
| xargs git push origin --delete
</pre></td></tr></tbody></table>
</div>

<p>Here we see many of the same basic sub-commands we used before. There is, however, one note-worthy difference. We specify the specific branch we want to check whether the remote branches have been merged into by specifying <code>origin/master</code>. This ensures that only remote branches that have been merged into remote <code>master</code> are passed to the next sub-command.</p>

<h3 id="deleting-already-merged-local-branches">Deleting already-merged local branches</h3>

<p>Finally, if you need to clean up your local repository, you can prune the local branches that have already been merged into <code>master</code> in a similar way:</p>

<div class="highlight shell"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class="lineno">1</pre></td><td class="code"><pre>git branch -d <span class="k">$(</span>git branch --merged master | grep -E -v <span class="s1">'\*|master|prod'</span><span class="k">)</span>
</pre></td></tr></tbody></table>
</div>

<p>A word of warning though: have local copies of these branches somewhere, just in case you delete a branch you want back at some point ;)</p>

  </article>

  <div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_shortname = 'fractaledmind';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  <script type="text/javascript">
//<![CDATA[
    var disqus_shortname = 'fractaledmind';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
//]]>
</script>


    </div>

    <aside id="sidebar">

  <div id="comic">
  </div>

  <hr class="fractal">

  <div id="recent-articles">
    <h5>Recent Articles</h5>
    <ul class="fa-ul">
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../portrait-of-pain/">Portrait of Pain</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../elevator/">Elevator</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="./">Cleaning up Git repos</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../you-made-and-unmade/">You, Made and Unmade</a>
        </li>
        <li>
          <i class="fa-li fa fa-chevron-right"></i>
          <a href="../conjunctive-binarism/">Conjunctive Binarism</a>
        </li>
    </ul>
  </div>

  <div id="all-tags">
    <h5>Tags</h5>
    <ul>
      <!-- Add all Article tags -->
        <li>
          <a class="badge no-hvr" id="hackademics" href="/topics/hackademics/">hackademics (1)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="grad-school" href="/topics/grad-school/">grad-school (2)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="til" href="/topics/til/">til (1)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="logic" href="/topics/logic/">logic (1)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="epistemology" href="/topics/epistemology/">epistemology (1)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="poetry" href="/topics/poetry/">poetry (1)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="example" href="/topics/example/">example (1)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="christianity" href="/topics/christianity/">christianity (1)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="love" href="/topics/love/">love (1)</a>
        </li>
        <li>
          <a class="badge no-hvr" id="prose" href="/topics/prose/">prose (2)</a>
        </li>

      <!-- Add all Project tags -->
        <a class="badge no-hvr" id="alfred" href="/topics/alfred">alfred (9)</a>
        <a class="badge no-hvr" id="git" href="/topics/git">git (1)</a>
        <a class="badge no-hvr" id="bash" href="/topics/bash">bash (2)</a>
        <a class="badge no-hvr" id="python" href="/topics/python">python (1)</a>
    </ul>
  </div>

</aside>


    <footer role="contentinfo">
  <div class="footer-info">
    <p>&copy; Copyright 2015 by Stephen Margheim</p>
    <p>Powered by <a href="https://middlemanapp.com">Middleman</a>.</p>
  </div>
</footer>


  </body>
</html>
